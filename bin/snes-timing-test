#!/usr/bin/python
import sys, time
from snes import core

game_path = sys.argv[1]

frame_counter = 0
sample_counter = 0
input_poll_counter = 0

def video_refresh_callback(*args):
	global frame_counter
	frame_counter += 1

def audio_sample_callback(*args):
	global sample_counter
	sample_counter += 1

def input_poll_callback():
	global input_poll_counter
	input_poll_counter += 1

core.set_video_refresh(video_refresh_callback)
core.set_audio_sample(audio_sample_callback)
core.set_input_poll(input_poll_callback)

with open(game_path, "rb") as handle:
	core.load_cartridge_normal(handle.read())

RUN_COUNT = 120

start = time.clock()
for i in range(RUN_COUNT):
	core.run()

elapsed = time.clock() - start

print "%d frames in %0.3f seconds; %0.1fps" % (
		frame_counter, elapsed, (frame_counter/elapsed)
	)
